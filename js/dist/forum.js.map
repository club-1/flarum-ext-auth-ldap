{"version":3,"file":"forum.js","mappings":"MACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,CAAM,ECLdF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDR,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFf,EAAyBM,IACH,oBAAXa,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeL,EAASa,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeL,EAAS,aAAc,CAAEe,OAAO,GAAO,G,+BCL9D,MAAM,EAA+BC,OAAOC,KAAKC,OAAO,iBCAlD,EAA+BF,OAAOC,KAAKC,OAAO,c,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,8B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,2B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,qB,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,yB,aCAzC,SAASC,EAAgBhB,EAAGiB,GAMzC,OALAD,EAAkBf,OAAOiB,gBAAkB,SAAyBlB,EAAGiB,GAErE,OADAjB,EAAEmB,UAAYF,EACPjB,CACR,EAEMgB,EAAgBhB,EAAGiB,EAC3B,CCPoCJ,OAAOC,KAAKC,OAAe,OAAhE,MCAM,EAA+BF,OAAOC,KAAKC,OAAY,I,aCA7D,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,oB,aCAnBF,OAAOC,KAAKC,OAAO,0BCAnBF,OAAOC,KAAKC,OAAO,2BDAxD,MEAM,EAA+BF,OAAOC,KAAKC,OAAO,qB,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,kB,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,gB,aCanCK,EAAAA,SAAAA,GCZN,IAAwBC,EAAUC,E,kDAAAA,E,GAAVD,E,GAC5Bd,UAAYN,OAAOsB,OAAOD,EAAWf,WAC9Cc,EAASd,UAAUiB,YAAcH,EACjCH,EAAeG,EAAUC,G,2BDUzBG,OAAA,SAAOC,GACL,YAAMD,OAAN,UAAaC,GAObC,KAAKC,eAAiBC,IAAOF,KAAKG,MAAMF,gBAAkB,IAO1DD,KAAKI,SAAWF,IAAOF,KAAKG,MAAMC,UAAY,IAO9CJ,KAAKK,SAAWH,MAASF,KAAKG,MAAME,SACrC,E,EAEDC,UAAA,WACE,MAAO,yBACR,E,EAEDC,MAAA,WACE,OAAOC,IAAAA,WAAAA,MAAqBC,0CAAmC,CAACC,OAAQF,IAAAA,MAAAA,UAAoB,qBAC7F,E,EAEDG,QAAA,WACE,MAAO,CACL,SAAKL,UAAU,cACZN,KAAKY,QAER,SAAKN,UAAU,gBACZN,KAAKa,UAGX,E,EAEDD,KAAA,WACE,MAAO,CAGL,SAAKN,UAAU,uBACZN,KAAKc,SAASC,WAGpB,E,EAEDD,OAAA,WACE,IAAME,EAAQ,IAAIC,KAkClB,OAhCAD,EAAME,IAAI,iBAAkB,SAAKZ,UAAU,cACzC,WAAOA,UAAU,cAAca,KAAK,iBAAiBC,KAAK,OAAOC,YAAaC,IAAYd,IAAAA,WAAAA,MAAqB,oDAC7Ge,KAAMvB,KAAKC,eACXuB,SAAUxB,KAAKG,MAAMsB,WACjB,IAERT,EAAME,IAAI,WAAY,SAAKZ,UAAU,cACnC,WAAOA,UAAU,cAAca,KAAK,WAAWC,KAAK,WAAWC,YAAaC,IAAYd,IAAAA,WAAAA,MAAqB,2CAC3Ge,KAAMvB,KAAKI,SACXoB,SAAUxB,KAAKG,MAAMsB,WACjB,IAWRT,EAAME,IAAI,SAAU,SAAKZ,UAAU,cAChCoB,IAAAA,UACC,CACEpB,UAAW,uCACXc,KAAM,SACNK,QAASzB,KAAKG,MAAMsB,SAEtBjB,IAAAA,WAAAA,MAAqB,sCAEhB,IAEFQ,CACR,E,EAEDH,OAAA,WACE,MAAO,EAWR,E,EAEDc,QAAA,WACE3B,KAAK4B,EAAE,UAAY5B,KAAKC,iBAAmB,WAAa,kBAAoB,KAAK4B,QAClF,E,EAEDC,SAAA,SAASC,GACPA,EAAEC,iBAEFhC,KAAKyB,SAAU,EAEf,IAKMQ,EAAO,CAAChC,eALSD,KAAKC,iBAKEG,SAJbJ,KAAKI,WAIkBC,SAHvBL,KAAKK,WAG4B6B,UAFhC1B,IAAAA,QAAAA,WAOZ2B,GAJyBnC,KAAKoC,QAAQC,KAAKrC,MAIjC4B,EAAEU,SACZC,EAAM/B,IAAAA,MAAAA,UAAoB,WAAa,aACvCW,EAAO,WAETqB,EAAOC,SAASC,cAAc,QAIlC,IAAK,IAAIC,KAHTH,EAAKI,aAAa,SAAU,QAC5BJ,EAAKI,aAAa,SAAUL,GAC5BC,EAAKI,aAAa,SAAUzB,GACdc,EACV,GAAIA,EAAKpD,eAAe8D,GAAI,CACvB,IAAIE,EAAQJ,SAASC,cAAc,SACnCG,EAAMzB,KAAO,SACbyB,EAAM1B,KAAOwB,EACbE,EAAM5D,MAAQgD,EAAKU,GACnBH,EAAKM,YAAYD,EACpB,CAENJ,SAAS7B,KAAKkC,YAAYN,GAE1BF,OAAOS,KAAK,GAAI5B,EACd,6BAEOgB,EAAQa,SAAW,EAAIA,KAF9B,UAGQb,EAAQc,QAAU,EAAIA,KAH9B,yCAMFT,EAAKU,SACLT,SAAS7B,KAAKuC,YAAYX,EAC3B,E,EAEDJ,QAAA,SAAQgB,GACe,MAAjBA,EAAMC,SACRD,EAAME,MAAMC,SAAW/C,IAAAA,WAAAA,MAAqB,4CAG9C,YAAM4B,QAAN,UAAcgB,EACf,E,EAlKkB3D,CAAuB+D,KED5ChD,IAAAA,aAAAA,IAAqB,yBAAyB,YAE7CiD,EAAAA,EAAAA,QAAOC,IAAAA,UAA2B,SAkBlC,SAAsB1C,GACjBA,EAAM2C,IAAI,UACb3C,EAAME,IAAI,YACTQ,IAAAA,UACE,CACMpB,UAAW,sBACXsD,QAAS,kBAAMpD,IAAAA,MAAAA,KAAef,EAArB,GAEXe,IAAAA,WAAAA,MAAqBC,0CAAmC,CAACC,OAAQF,IAAAA,MAAAA,UAAoB,wCAEvF,EAGN,KA9BDiD,EAAAA,EAAAA,QAAOC,IAAAA,UAA2B,SAgClC,SAAyB1C,GACpBR,IAAAA,MAAAA,UAAoB,mCACnBQ,EAAM2C,IAAI,WACb3C,EAAM6C,OAAO,UAEV7C,EAAM2C,IAAI,UACb3C,EAAM6C,OAAO,SAGf,KAxCDJ,EAAAA,EAAAA,QAAOK,IAAAA,UAAsB,WAK7B,WACKtD,IAAAA,MAAAA,UAAoB,mCACvBsD,IAAAA,UAAAA,QAA+BrE,EAAeb,UAAU+B,QACxDmD,IAAAA,UAAAA,MAA6BrE,EAAeb,UAAU2B,MACtDuD,IAAAA,UAAAA,KAA4BrE,EAAeb,UAAUgC,KACrDkD,IAAAA,UAAAA,OAA8BrE,EAAeb,UAAUkC,OACvDgD,IAAAA,UAAAA,OAA8BrE,EAAeb,UAAUiC,OACvDiD,IAAAA,UAAAA,SAAgCrE,EAAeb,UAAUkD,SAE1D,KAZD2B,EAAAA,EAAAA,QAAOM,IAAAA,UAAwB,gBAwC/B,SAA8B/C,GAC7BA,EAAM6C,OAAO,eACb7C,EAAM6C,OAAO,iBACb,KA1CDJ,EAAAA,EAAAA,QAAOM,IAAAA,UAAwB,iBA4C/B,SAAmC/C,GAC9BA,EAAM2C,IAAI,YAC4B,IAAzC3C,EAAMvC,IAAI,WAAW8E,SAASS,QAC9BhD,EAAM6C,OAAO,UAEd,GACD,G","sources":["webpack://@tituspijean/auth-ldap/webpack/bootstrap","webpack://@tituspijean/auth-ldap/webpack/runtime/compat get default export","webpack://@tituspijean/auth-ldap/webpack/runtime/define property getters","webpack://@tituspijean/auth-ldap/webpack/runtime/hasOwnProperty shorthand","webpack://@tituspijean/auth-ldap/webpack/runtime/make namespace object","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['common/extend']\"","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['common/app']\"","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['components/HeaderSecondary']\"","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['components/SettingsPage']\"","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['components/Button']\"","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['components/LogInModal']\"","webpack://@tituspijean/auth-ldap/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['extend']\"","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['app']\"","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['components/Modal']\"","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['components/SignUpModal']\"","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['components/LogInButtons']\"","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['utils/extractText']\"","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['utils/ItemList']\"","webpack://@tituspijean/auth-ldap/external root \"flarum.core.compat['utils/Stream']\"","webpack://@tituspijean/auth-ldap/./src/forum/components/LDAPLogInModal.js","webpack://@tituspijean/auth-ldap/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@tituspijean/auth-ldap/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/HeaderSecondary'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/SettingsPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/LogInModal'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/SignUpModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/LogInButtons'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['utils/extractText'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['utils/Stream'];","import { extend } from 'flarum/extend';\nimport app from 'flarum/app';\n\nimport Modal from 'flarum/components/Modal';\nimport SignUpModal from 'flarum/components/SignUpModal';\nimport Button from 'flarum/components/Button';\nimport LogInButtons from 'flarum/components/LogInButtons';\nimport extractText from 'flarum/utils/extractText';\nimport ItemList from 'flarum/utils/ItemList';\nimport Stream from 'flarum/utils/Stream';\n\nconst translationPrefix = 'tituspijean-auth-ldap.forum.';\n\nexport default class LDAPLogInModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    /**\n     * The value of the identification input.\n     *\n     * @type {Function}\n     */\n    this.identification = Stream(this.attrs.identification || '');\n\n    /**\n     * The value of the password input.\n     *\n     * @type {Function}\n     */\n    this.password = Stream(this.attrs.password || '');\n\n    /**\n     * The value of the remember me input.\n     *\n     * @type {Function}\n     */\n    this.remember = Stream(!!this.attrs.remember);\n  }\n\n  className() {\n    return 'LogInModal Modal--small';\n  }\n\n  title() {\n    return app.translator.trans(translationPrefix + 'log_in_with', {server: app.forum.attribute('LDAP_method_name')});\n  }\n\n  content() {\n    return [\n      <div className=\"Modal-body\">\n        {this.body()}\n      </div>,\n      <div className=\"Modal-footer\">\n        {this.footer()}\n      </div>\n    ];\n  }\n\n  body() {\n    return [\n      //<LogInButtons/>,\n\n      <div className=\"Form Form--centered\">\n        {this.fields().toArray()}\n      </div>\n    ];\n  }\n\n  fields() {\n    const items = new ItemList();\n\n    items.add('identification', <div className=\"Form-group\">\n      <input className=\"FormControl\" name=\"identification\" type=\"text\" placeholder={extractText(app.translator.trans('core.forum.log_in.username_or_email_placeholder'))}\n        bidi={this.identification}\n        disabled={this.attrs.loading} />\n    </div>, 30);\n\n    items.add('password', <div className=\"Form-group\">\n      <input className=\"FormControl\" name=\"password\" type=\"password\" placeholder={extractText(app.translator.trans('core.forum.log_in.password_placeholder'))}\n        bidi={this.password}\n        disabled={this.attrs.loading} />\n    </div>, 20);\n\n    /*items.add('remember', <div className=\"Form-group\">\n      <div>\n        <label className=\"checkbox\">\n          <input type=\"checkbox\" bidi={this.remember} disabled={this.loading} />\n          {app.translator.trans('core.forum.log_in.remember_me_label')}\n        </label>\n      </div>\n    </div>, 10);*/\n\n    items.add('submit', <div className=\"Form-group\">\n      {Button.component(\n        {\n          className: 'Button Button--primary Button--block',\n          type: 'submit',\n          loading: this.attrs.loading,\n        },\n        app.translator.trans('core.forum.log_in.submit_button')\n      )}\n    </div>, -10);\n\n    return items;\n  }\n\n  footer() {\n    return [\n      /*<p className=\"LogInModal-forgotPassword\">\n        <a onclick={this.forgotPassword.bind(this)}>{app.translator.trans('core.forum.log_in.forgot_password_link')}</a>\n      </p>,\n\n      app.forum.attribute('allowSignUp') ? (\n        <p className=\"LogInModal-signUp\">\n          {app.translator.trans('core.forum.log_in.sign_up_text', {a: <a onclick={this.signUp.bind(this)}/>})}\n        </p>\n      ) : ''*/\n    ];\n  }\n\n  onready() {\n    this.$('[name=' + (this.identification() ? 'password' : 'identification') + ']').select();\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    this.loading = true;\n\n    const identification = this.identification();\n    const password = this.password();\n    const remember = this.remember();\n    const csrfToken = app.session.csrfToken;\n\n    const data = {identification, password, remember, csrfToken};\n    const options = {errorHandler: this.onerror.bind(this)};\n\n    const width = 600;\n    const height = 400;\n    const $window = $(window);\n    const url = app.forum.attribute('baseUrl') + '/auth/ldap';\n    const name = \"ldapauth\";\n\n    var form = document.createElement(\"form\");\n    form.setAttribute(\"method\", \"POST\");\n    form.setAttribute(\"action\", url);\n    form.setAttribute(\"target\", name);\n    for (var i in data) {\n        if (data.hasOwnProperty(i)) {\n             var input = document.createElement('input');\n             input.type = 'hidden';\n             input.name = i;\n             input.value = data[i];\n             form.appendChild(input);\n         }\n    }\n    document.body.appendChild(form);\n\n    window.open(\"\", name,\n      `width=${width},` +\n      `height=${height},` +\n      `top=${$window.height() / 2 - height / 2},` +\n      `left=${$window.width() / 2 - width / 2},` +\n      'status=no,scrollbars=no,resizable=no');\n\n    form.submit();\n    document.body.removeChild(form);\n  }\n\n  onerror(error) {\n    if (error.status === 401) {\n      error.alert.children = app.translator.trans('core.forum.log_in.invalid_login_message');\n    }\n\n    super.onerror(error);\n  }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import { extend, override } from 'flarum/common/extend';\nimport app from 'flarum/common/app';\n\nimport HeaderSecondary from \"flarum/components/HeaderSecondary\";\nimport SettingsPage from \"flarum/components/SettingsPage\";\nimport Button from 'flarum/components/Button';\n\nimport LogInModal from \"flarum/components/LogInModal\";\nimport LDAPLogInModal from \"./components/LDAPLogInModal\";\n\nconst translationPrefix = 'tituspijean-auth-ldap.forum.';\n\napp.initializers.add('tituspijean-auth-ldap', () => {\n\n\textend(HeaderSecondary.prototype, 'items', addLoginLink);\n\textend(HeaderSecondary.prototype, 'items', removeIfOnlyUse);\n\textend(LogInModal.prototype, 'content', overrideModal);\n\n\textend(SettingsPage.prototype, 'accountItems', removeProfileActions);\n\textend(SettingsPage.prototype, 'settingsItems', checkRemoveAccountSection);\n\n\tfunction overrideModal() {\n\t\tif (app.forum.attribute('tituspijean-auth-ldap.onlyUse')) {\n\t\t\tLogInModal.prototype.content = LDAPLogInModal.prototype.content\n\t\t\tLogInModal.prototype.title = LDAPLogInModal.prototype.title\n\t\t\tLogInModal.prototype.body = LDAPLogInModal.prototype.body\n\t\t\tLogInModal.prototype.fields = LDAPLogInModal.prototype.fields\n\t\t\tLogInModal.prototype.footer = LDAPLogInModal.prototype.footer\n\t\t\tLogInModal.prototype.onsubmit = LDAPLogInModal.prototype.onsubmit\n\t\t}\n\t}\n\n\tfunction addLoginLink(items) {\n\t\tif (items.has('logIn')) {\n\t\t\titems.add('logInLDAP',\n\t\t\t\tButton.component(\n\t\t\t\t  {\n            className: 'Button Button--link',\n            onclick: () => app.modal.show(LDAPLogInModal)\n\t\t\t\t  },\n          app.translator.trans(translationPrefix + 'log_in_with', {server: app.forum.attribute('tituspijean-auth-ldap.method_name')})\n\t\t\t\t),\n        0\n\t\t\t);\n\t\t}\n\t}\n\n\tfunction removeIfOnlyUse(items) {\n\t\tif (app.forum.attribute('tituspijean-auth-ldap.onlyUse')) {\n\t\t\tif (items.has('signUp')) {\n\t\t\t\titems.remove('signUp');\n\t\t\t}\n\t\t\tif (items.has('logIn')) {\n\t\t\t\titems.remove('logIn');\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction removeProfileActions(items) {\n\t\titems.remove('changeEmail');\n\t\titems.remove('changePassword');\n\t}\n\n\tfunction checkRemoveAccountSection(items) {\n\t\tif (items.has('account') &&\n\t\t\titems.get('account').children.length === 0) {\n\t\t\titems.remove('account');\n\t\t}\n\t}\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","__proto__","LDAPLogInModal","subClass","superClass","create","constructor","oninit","vnode","this","identification","Stream","attrs","password","remember","className","title","app","translationPrefix","server","content","body","footer","fields","toArray","items","ItemList","add","name","type","placeholder","extractText","bidi","disabled","loading","Button","onready","$","select","onsubmit","e","preventDefault","data","csrfToken","$window","onerror","bind","window","url","form","document","createElement","i","setAttribute","input","appendChild","open","height","width","submit","removeChild","error","status","alert","children","Modal","extend","HeaderSecondary","has","onclick","remove","LogInModal","SettingsPage","length"],"sourceRoot":""}